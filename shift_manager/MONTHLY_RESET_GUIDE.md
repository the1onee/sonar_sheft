# ๐ ุฏููู ุงูุชุตููุฑ ุงูุดูุฑู ูุณุงุนุงุช ุงูุนูู

## ๐ฏ ุงููุฏู

ูุธุงู **ุงูุชุตููุฑ ุงูุดูุฑู** ูุถูู:
- โ ุจุฏุงูุฉ ุนุงุฏูุฉ ูุฌููุน ุงูููุธููู ูู ูู ุดูุฑ ุฌุฏูุฏ
- โ ุนุฏู ุชุฑุงูู ุงูุณุงุนุงุช ุจุดูู ูุง ููุงุฆู
- โ ุงูุญูุงุธ ุนูู ุงูุณุฌูุงุช ุงูุชุงุฑูุฎูุฉ ูุฃุบุฑุงุถ ุงูุชูุงุฑูุฑ
- โ ุชุญููุฒ ุงูููุธููู ุจูุฑุตุฉ ุฌุฏูุฏุฉ ูู ุดูุฑ

---

## ๐ ููู ูุนูู ุงููุธุงูุ

### 1๏ธโฃ ุงูุชุตููุฑ ุงูุชููุงุฆู
- **ุงูููุนุฏ**: ุฃูู ููู ูู ูู ุดูุฑ ูู ุชูุงู ุงูุณุงุนุฉ **00:00** (ููุชุตู ุงูููู)
- **ุงูุฅุฌุฑุงุก**: ูุชู ุชุตููุฑ `total_work_hours` ูุฌููุน ุงูููุธููู ุฅูู 0.0
- **ุงูุชุดุบูู**: ุชููุงุฆู ุจุงููุงูู ุนุจุฑ Celery Beat (ูุง ูุญุชุงุฌ ุชุฏุฎู ูุฏูู)

### 2๏ธโฃ ูุง ูุชู ุชุตููุฑูุ
```python
# ููู ููุธู:
emp.total_work_hours = 0.0
emp.last_work_datetime = None
emp.consecutive_rest_count = 0
```

### 3๏ธโฃ ูุง ูุจูู ูุญููุธุงูุ
- โ ุฌููุน ุณุฌูุงุช `EmployeeAssignment` (ุงูุชุจุฏููุงุช ุงูุณุงุจูุฉ)
- โ ุจูุงูุงุช ุงูููุธููู ุงูุฃุณุงุณูุฉ
- โ ุณุฌู ุงูุชุตููุฑ ููุณู ูู `MonthlyWorkHoursReset`

---

## ๐ ุณุฌูุงุช ุงูุชุตููุฑ

### Model: MonthlyWorkHoursReset

ูุญูุธ ูุนูููุงุช ูู ุนูููุฉ ุชุตููุฑ:

| ุงูุญูู | ุงููุตู |
|------|-------|
| `year` | ุงูุณูุฉ (ูุซู: 2024) |
| `month` | ุงูุดูุฑ (1-12) |
| `reset_datetime` | ุชุงุฑูุฎ ูููุช ุงูุชุตููุฑ ุงููุนูู |
| `total_employees` | ุนุฏุฏ ุงูููุธููู ููุช ุงูุชุตููุฑ |
| `total_hours_before_reset` | ุฅุฌูุงูู ุณุงุนุงุช ุฌููุน ุงูููุธููู ูุจู ุงูุชุตููุฑ |
| `average_hours_before_reset` | ูุชูุณุท ุณุงุนุงุช ุงูุนูู/ููุธู ูุจู ุงูุชุตููุฑ |

### ูุซุงู ุณุฌู:
```
ุชุตููุฑ 2024-11
- ุนุฏุฏ ุงูููุธููู: 15 ููุธู
- ุฅุฌูุงูู ุงูุณุงุนุงุช: 450.5 ุณุงุนุฉ
- ูุชูุณุท ุงูุณุงุนุงุช: 30.0 ุณุงุนุฉ/ููุธู
- ุชุงุฑูุฎ ุงูุชุตููุฑ: 2024-11-01 00:00:00
```

---

## ๐ข ุงูุฅุดุนุงุฑุงุช

### ูู ูุชููู ุงูุฅุดุนุงุฑุ
- ุงููุฏูุฑูู (Manager)
- ุงููุดุฑููู (Supervisor)
- ุงูุฃุฏูู (Superuser)

### ูุญุชูู ุงูุฅุดุนุงุฑ (Telegram):
```
๐ ุชุตููุฑ ุณุงุนุงุช ุงูุนูู ุงูุดูุฑูุฉ

๐ ุงูุดูุฑ: 2024-11
๐ ุงูููุช: 2024-11-01 00:00

๐ ุงูุฅุญุตุงุฆูุงุช:
โข ุนุฏุฏ ุงูููุธููู: 15
โข ุฅุฌูุงูู ุงูุณุงุนุงุช: 450.5 ุณุงุนุฉ
โข ูุชูุณุท ุงูุณุงุนุงุช: 30.0 ุณุงุนุฉ/ููุธู

โ ุชู ุชุตููุฑ ุณุงุนุงุช ุฌููุน ุงูููุธููู ุจูุฌุงุญ!

๐ก ููุงุญุธุฉ:
- ุงูุณุฌูุงุช ุงูุชุงุฑูุฎูุฉ ูุญููุธุฉ ูู ุงูุชูุงุฑูุฑ
- ุงูููุธููู ูุจุฏุฃูู ูู ุฌุฏูุฏ ุจู 0 ุณุงุนุฉ
- ูุธุงู ุงูุนุฏุงูุฉ ูุนูู ูู ุงูุจุฏุงูุฉ

ุดูุฑ ุฌุฏูุฏ ุณุนูุฏ! ๐
```

---

## ๐ฅ๏ธ ุงูุนุฑุถ ูู ุงููุงุฌูุฉ

### ุตูุญุฉ ุงูุชูุงุฑูุฑ (`/reports/`)

ุชู ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ: **"ุณุฌูุงุช ุงูุชุตููุฑ ุงูุดูุฑูุฉ"**

#### ุงููุนูููุงุช ุงููุนุฑูุถุฉ:
- ุงูุณูุฉ ูุงูุดูุฑ (ุจุงููุบุฉ ุงูุนุฑุจูุฉ)
- ุชุงุฑูุฎ ูููุช ุงูุชุตููุฑ
- ุนุฏุฏ ุงูููุธููู
- ุฅุฌูุงูู ุงูุณุงุนุงุช ูุจู ุงูุชุตููุฑ
- ูุชูุณุท ุงูุณุงุนุงุช/ููุธู

#### ููุฒุงุช ุงูุนุฑุถ:
- ุนุฑุถ ุขุฎุฑ **12 ุดูุฑ**
- ุฃููุงู ูููุฒุฉ (ุชุฏุฑุฌุงุช ุงูุฃุฒุฑู)
- ููุงุญุธุงุช ุชูุถูุญูุฉ
- ุฑุณุงูุฉ ุชุญููุฒูุฉ "ุดูุฑ ุฌุฏูุฏ ุณุนูุฏ! ๐"

---

## โ๏ธ ุฌุฏููุฉ Celery Beat

ุชูุช ุฅุถุงูุฉ ุงููููุฉ ูู `celery.py`:

```python
'reset-monthly-work-hours': {
    'task': 'shifts.tasks.reset_monthly_work_hours',
    'schedule': crontab(minute=0, hour=0, day_of_month=1),
    # ุงูุณุงุนุฉ 00:00 ูู ุงูููู ุงูุฃูู ูู ูู ุดูุฑ
}
```

### ุงูุชุญูู ูู ุงูุฌุฏููุฉ:
```bash
# ุนุฑุถ ุฌููุน ุงูููุงู ุงููุฌุฏููุฉ
celery -A shift_manager inspect scheduled
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1๏ธโฃ ุงุฎุชุจุงุฑ ูุฏูู (ูู Python shell):
```bash
cd shift_manager
python manage.py shell
```

```python
from shifts.tasks import reset_monthly_work_hours

# ุชุดุบูู ุงููููุฉ ูุฏููุงู
result = reset_monthly_work_hours.delay()
print(result.get())
```

### 2๏ธโฃ ุงูุชุญูู ูู ุงูุณุฌูุงุช:
```python
from shifts.models import MonthlyWorkHoursReset

# ุนุฑุถ ุขุฎุฑ 5 ุนูููุงุช ุชุตููุฑ
resets = MonthlyWorkHoursReset.objects.all()[:5]
for reset in resets:
    print(f"{reset.year}-{reset.month:02d}: {reset.total_employees} ููุธูุ {reset.total_hours_before_reset:.1f} ุณุงุนุฉ")
```

### 3๏ธโฃ ุงูุชุญูู ูู ุงูููุธููู:
```python
from shifts.models import Employee

# ุงูุชุญูู ูู ุชุตููุฑ ุณุงุนุงุช ุงูุนูู
for emp in Employee.objects.all():
    print(f"{emp.name}: {emp.total_work_hours} ุณุงุนุฉ")
```

---

## ๐ฏ ุงูุณููู ุงููุชููุน

### ูุจู ุงูุชุตููุฑ (31 ุฃูุชูุจุฑ):
```
ุฃุญูุฏ: 45.5 ุณุงุนุฉ
ูุญูุฏ: 32.0 ุณุงุนุฉ
ูุงุทูุฉ: 50.2 ุณุงุนุฉ
```

### ุจุนุฏ ุงูุชุตููุฑ (1 ููููุจุฑ - 00:00):
```
ุฃุญูุฏ: 0.0 ุณุงุนุฉ
ูุญูุฏ: 0.0 ุณุงุนุฉ
ูุงุทูุฉ: 0.0 ุณุงุนุฉ
```

### ุงูุณุฌูุงุช ุงููุญููุธุฉ:
- ุฌููุน ุชุจุฏููุงุช ุฃูุชูุจุฑ ููุฌูุฏุฉ ูู `EmployeeAssignment`
- ุณุฌู ุงูุชุตููุฑ ููุฌูุฏ ูู `MonthlyWorkHoursReset`
- ูููู ุนุฑุถ ุงูุชูุงุฑูุฑ ูุฃู ุดูุฑ ุณุงุจู

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ ุงููุฒุงูุง:
1. **ุนุฏุงูุฉ ุฏุงุฆูุฉ**: ูู ููุธู ูุจุฏุฃ ูู ููุทุฉ ุงูุตูุฑ ุดูุฑูุงู
2. **ุญูุธ ุงูุณุฌูุงุช**: ูุง ููููุฏ ุฃู ุจูุงูุงุช ุชุงุฑูุฎูุฉ
3. **ุชููุงุฆู ุจุงููุงูู**: ูุง ูุญุชุงุฌ ุชุฏุฎู ูุฏูู
4. **ุดูุงููุฉ**: ุณุฌูุงุช ูุงุถุญุฉ ููู ุนูููุฉ ุชุตููุฑ

### โ๏ธ ุชุญุฐูุฑุงุช:
1. **ูุง ุญุฐู**: ูุง ูููู ุญุฐู ุณุฌูุงุช ุงูุชุตููุฑ ูู ุงููุงุฌูุฉ (ุญูุงุธุงู ุนูู ุงูุฃุฑุดูู)
2. **ูุง ุฅุถุงูุฉ ูุฏููุฉ**: ูุง ูููู ุฅุถุงูุฉ ุณุฌูุงุช ุชุตููุฑ ูุฏููุงู (ูุชู ุชููุงุฆูุงู ููุท)
3. **ุชุตููุฑ ูุงุญุฏ/ุดูุฑ**: ุงููุธุงู ูุณูุญ ุจุณุฌู ุชุตููุฑ ูุงุญุฏ ููู ุดูุฑ (unique constraint)

---

## ๐ ุงูุชุทุจูู ูุงูุชูุนูู

### 1๏ธโฃ ุชุทุจูู Migration:
```bash
cd shift_manager
python manage.py migrate
```

### 2๏ธโฃ ุฅุนุงุฏุฉ ุชุดุบูู Celery Beat:
```bash
# ุฅููุงู Celery Beat ุงูุญุงูู
# (ุงุณุชุฎุฏู Ctrl+C ุฃู ุฃุบูู ุงููุงูุฐุฉ)

# ุชุดุบูู ุฌุฏูุฏ
START_CELERY.bat
```

### 3๏ธโฃ ุงูุชุญูู ูู ุงูุชุดุบูู:
```bash
# ูู Python shell
from celery import current_app
print(current_app.conf.beat_schedule)
# ูุฌุจ ุฃู ุชุฑู 'reset-monthly-work-hours' ูู ุงููุงุฆูุฉ
```

---

## ๐ง ุงูุตูุงูุฉ

### ุฅุฐุง ุงุญุชุฌุช ุชุดุบูู ุชุตููุฑ ุงุณุชุซูุงุฆู:
```python
# ูู Django shell
from shifts.tasks import reset_monthly_work_hours
reset_monthly_work_hours()
```

### ุนุฑุถ ููุฌ ุงูุชุตููุฑ:
```bash
# ุณูุทุจุน ูู ุงููููุณูู:
========================================
๐ ุจุฏุก ุนูููุฉ ุชุตููุฑ ุณุงุนุงุช ุงูุนูู ุงูุดูุฑูุฉ
========================================

๐ ุนุฏุฏ ุงูููุธููู: 15
๐ ุงูุดูุฑ ุงูุญุงูู: 2024-11
๐ ุงูููุช: 2024-11-01 00:00

๐ ุฅุญุตุงุฆูุงุช ูุจู ุงูุชุตููุฑ:
  โข ุฅุฌูุงูู ุงูุณุงุนุงุช: 450.5 ุณุงุนุฉ
  โข ูุชูุณุท ุงูุณุงุนุงุช: 30.0 ุณุงุนุฉ/ููุธู

  ๐ ุฃูุซุฑ 5 ููุธููู ุนููุงู:
    1. ูุงุทูุฉ: 50.2 ุณุงุนุฉ
    2. ุฃุญูุฏ: 45.5 ุณุงุนุฉ
    ...

๐ ุฌุงุฑู ุชุตููุฑ ุณุงุนุงุช ุงูุนูู...
  โ ุฃุญูุฏ: 45.5 โ 0.0 ุณุงุนุฉ
  โ ูุญูุฏ: 32.0 โ 0.0 ุณุงุนุฉ
  โ ูุงุทูุฉ: 50.2 โ 0.0 ุณุงุนุฉ

โ ุชู ุชุตููุฑ ุณุงุนุงุช 15 ููุธู ุจูุฌุงุญ!
๐ ุชู ุญูุธ ุณุฌู ุงูุชุตููุฑ ุงูุดูุฑู (ID: 1)

๐ข ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุฅุฏุงุฑุฉ...
  โ ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ุฅูู: admin
  โ ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ุฅูู: manager1

========================================
โ ุงูุชููุช ุนูููุฉ ุงูุชุตููุฑ ุงูุดูุฑูุฉ ุจูุฌุงุญ!
========================================
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. Models (`shifts/models.py`)
- ุฅุถุงูุฉ `MonthlyWorkHoursReset` model

### 2. Tasks (`shifts/tasks.py`)
- ุฅุถุงูุฉ `reset_monthly_work_hours()` task

### 3. Celery Config (`shift_manager/celery.py`)
- ุฅุถุงูุฉ ุฌุฏููุฉ ุดูุฑูุฉ ูู `beat_schedule`

### 4. Admin (`shifts/admin.py`)
- ุชุณุฌูู `MonthlyWorkHoursResetAdmin`

### 5. Views (`shifts/views.py`)
- ุชุญุฏูุซ `reports_view()` ูุฌูุจ ุณุฌูุงุช ุงูุชุตููุฑ

### 6. Template (`templates/reports/index.html`)
- ุฅุถุงูุฉ ูุณู "ุณุฌูุงุช ุงูุชุตููุฑ ุงูุดูุฑูุฉ"

### 7. Migration
- `migrations/0023_monthly_reset.py`

---

## โ ุงูุฎูุงุตุฉ

ูุธุงู ุงูุชุตููุฑ ุงูุดูุฑู:
- โ ุชููุงุฆู ุจุงููุงูู
- โ ุขูู (ูุญูุธ ุงูุณุฌูุงุช)
- โ ุนุงุฏู (ุจุฏุงูุฉ ุฌุฏูุฏุฉ ูู ุดูุฑ)
- โ ุดูุงู (ุณุฌูุงุช ูุงุถุญุฉ)
- โ ูุงุจู ููุชุชุจุน (ุฅุดุนุงุฑุงุช + ุชูุงุฑูุฑ)

**๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

