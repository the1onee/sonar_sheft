{% extends 'base.html' %}

{% block title %}ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙˆÙ†Ø§Ø±{% endblock %}

{% block extra_css %}
<style>
    .report-header {
        background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        color: white;
        padding: 40px;
        border-radius: 20px;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(79, 70, 229, 0.3);
    }
    
    .report-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }
    
    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 900;
        color: #1F2937;
        margin: 10px 0;
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: #6B7280;
        font-weight: 600;
    }
    
    .filter-section {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
    }
    
    .export-buttons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
    }
    
    .btn-excel {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
    }
    
    .btn-excel:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        color: white;
    }
    
    .table-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }
    
    .table {
        margin: 0;
    }
    
    .table thead {
        background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        color: white;
    }
    
    .table thead th {
        border: none;
        padding: 15px;
        font-weight: 600;
        text-align: center;
        vertical-align: middle;
    }
    
    .table tbody tr {
        transition: all 0.2s ease;
    }
    
    .table tbody tr:hover {
        background: #F9FAFB;
        transform: scale(1.01);
    }
    
    .table tbody td {
        padding: 15px;
        text-align: center;
        vertical-align: middle;
    }
    
    .status-badge {
        padding: 8px 15px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
    }
    
    .progress-bar-container {
        width: 100%;
        height: 8px;
        background: #E5E7EB;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 5px;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #10B981 0%, #059669 100%);
        transition: width 0.3s ease;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="report-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="mb-2">
                    <i class="fas fa-chart-line"></i> ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                </h1>
                <p class="mb-0" style="opacity: 0.9;">ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø£Ø¯Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„Ù‡Ù…</p>
            </div>
            <a href="{% url 'reports' %}" class="btn btn-light btn-lg">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            </a>
        </div>
    </div>
    
    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="report-stats">
        <div class="stat-card">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-value">{{ total_employees }}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">â°</div>
            <div class="stat-value">{{ total_hours|floatformat:1 }}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-value">{{ avg_hours|floatformat:1 }}</div>
            <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
        </div>
    </div>
    
    <!-- Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„ØªØµØ¯ÙŠØ± -->
    <div class="filter-section">
        <h5 class="mb-3">
            <i class="fas fa-filter"></i> ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØµØ¯ÙŠØ±
        </h5>
        
        <form method="GET" id="filterForm">
            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" name="date_from" class="form-control" value="{{ date_from }}">
                </div>
                
                <div class="col-md-4">
                    <label class="form-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" name="date_to" class="form-control" value="{{ date_to }}">
                </div>
                
                <div class="col-md-4">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±
                    </button>
                </div>
            </div>
        </form>
        
        <div class="export-buttons">
            <a href="?export=excel{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}" class="btn-excel">
                <i class="fas fa-file-excel fa-lg"></i>
                <span>ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</span>
            </a>
            
            <button onclick="window.print()" class="btn btn-secondary">
                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
            </button>
        </div>
    </div>
    
    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
    <div class="table-container">
        <div style="padding: 20px; border-bottom: 1px solid #E5E7EB;">
            <h5 class="mb-0">
                <i class="fas fa-users"></i> ØªÙØ§ØµÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                <span class="badge bg-primary">{{ total_employees }} Ù…ÙˆØ¸Ù</span>
            </h5>
        </div>
        
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ù…Ø¹Ø±Ù ØªÙ„ÙŠØ¬Ø±Ø§Ù…</th>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                        <th>Ø³Ø§Ø¹Ø§Øª Ù…Ø¤ÙƒØ¯Ø©</th>
                        <th>Ø§Ù„ÙØ±Ù‚ Ø¹Ù† Ø§Ù„Ù…ØªÙˆØ³Ø·</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª</th>
                        <th>Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©</th>
                        <th>Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</th>
                        <th>Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯</th>
                        <th>Ø¢Ø®Ø± Ø¹Ù…Ù„</th>
                        <th>Ù…Ø±Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø©</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in employees_data %}
                    <tr {% if emp.is_on_leave %}style="background: #FEF3C7;"
                        {% elif emp.diff_from_avg > 5.0 %}style="background: #FEE2E2;"
                        {% elif emp.diff_from_avg < -5.0 %}style="background: #D1FAE5;"
                        {% endif %}>
                        <td><strong>{{ forloop.counter }}</strong></td>
                        <td>
                            <strong>{{ emp.name }}</strong>
                            {% if emp.is_on_leave %}
                                <br><small class="text-warning">ğŸ–ï¸ ÙÙŠ Ø¥Ø¬Ø§Ø²Ø©</small>
                            {% endif %}
                        </td>
                        <td><small>{{ emp.telegram_id }}</small></td>
                        <td>
                            <strong style="color: #4F46E5; font-size: 1.1rem;">
                                {{ emp.total_work_hours|floatformat:1 }}
                            </strong>
                            <small class="text-muted d-block">Ø³Ø§Ø¹Ø©</small>
                        </td>
                        <td>
                            <span class="badge bg-success" style="font-size: 0.95rem;">
                                {{ emp.confirmed_work_hours|floatformat:1 }} Ø³Ø§Ø¹Ø©
                            </span>
                        </td>
                        <td>
                            {% if emp.diff_from_avg > 0 %}
                                <span class="text-danger" style="font-weight: 700;">
                                    <i class="fas fa-arrow-up"></i> +{{ emp.diff_from_avg|floatformat:1 }}
                                </span>
                            {% elif emp.diff_from_avg < 0 %}
                                <span class="text-success" style="font-weight: 700;">
                                    <i class="fas fa-arrow-down"></i> {{ emp.diff_from_avg|floatformat:1 }}
                                </span>
                            {% else %}
                                <span class="text-muted">0.0</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-primary" style="font-size: 1rem;">
                                {{ emp.total_assignments }}
                            </span>
                        </td>
                        <td>
                            <span class="badge bg-success">
                                {{ emp.confirmed_assignments }}
                            </span>
                        </td>
                        <td>
                            <span class="badge bg-warning">
                                {{ emp.pending_assignments }}
                            </span>
                        </td>
                        <td>
                            <strong style="color: {% if emp.confirmation_rate >= 80 %}#10B981{% elif emp.confirmation_rate >= 50 %}#F59E0B{% else %}#EF4444{% endif %};">
                                {{ emp.confirmation_rate|floatformat:1 }}%
                            </strong>
                            <div class="progress-bar-container">
                                <div class="progress-bar-fill" style="width: {{ emp.confirmation_rate }}%; background: {% if emp.confirmation_rate >= 80 %}#10B981{% elif emp.confirmation_rate >= 50 %}#F59E0B{% else %}#EF4444{% endif %};"></div>
                            </div>
                        </td>
                        <td>
                            {% if emp.last_work %}
                                <small>{{ emp.last_work|date:"Y-m-d" }}<br>{{ emp.last_work|date:"H:i" }}</small>
                            {% else %}
                                <small class="text-muted">Ù„Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø¹Ø¯</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-info" style="font-size: 0.95rem;">
                                {{ emp.consecutive_rest }}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge bg-{{ emp.status_class }}">
                                {{ emp.status }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="13" class="text-center py-5">
                            <i class="fas fa-inbox fa-4x mb-3 d-block" style="opacity: 0.3;"></i>
                            <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸ÙÙŠÙ†</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
    <div class="alert alert-info mt-4" style="background: #EFF6FF; border: 1px solid #DBEAFE;">
        <h5 style="color: #1E40AF;">
            <i class="fas fa-info-circle"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:
        </h5>
        <ul class="mb-0" style="color: #1E40AF;">
            <li><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</strong> Ù…Ø¬Ù…ÙˆØ¹ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù…ÙˆØ¸Ù (ØªÙØµÙÙ‘Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹)</li>
            <li><strong>Ø³Ø§Ø¹Ø§Øª Ù…Ø¤ÙƒØ¯Ø©:</strong> Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù…Ù† Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© ÙÙ‚Ø·</li>
            <li><strong>Ø§Ù„ÙØ±Ù‚ Ø¹Ù† Ø§Ù„Ù…ØªÙˆØ³Ø·:</strong> Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù ÙˆÙ…ØªÙˆØ³Ø· Ø³Ø§Ø¹Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</li>
            <li><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯:</strong> Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„Ù…Ø´Ø±Ù</li>
            <li><strong>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©:</strong> ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</li>
            <li><strong>Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ:</strong> ÙŠØªÙ… ØªØµÙÙŠØ± Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ Ø´Ù‡Ø± (Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø©)</li>
        </ul>
    </div>
</div>

<style>
    @media print {
        .filter-section,
        .export-buttons,
        .btn,
        .alert {
            display: none !important;
        }
        
        .report-header {
            background: #4F46E5 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .table {
            font-size: 10px;
        }
        
        .table thead {
            background: #4F46E5 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
    }
</style>
{% endblock %}

